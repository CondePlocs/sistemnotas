@startuml Diagrama de Actividades - Registro de Notas

skinparam {
    ActivityBackgroundColor #F0F9FF
    ActivityBorderColor #1E40AF
    ActivityDiamondBackgroundColor #EEF2FF
    ActivityDiamondBorderColor #1E40AF
    ArrowColor #1F2937
    PartitionBorderColor #1E40AF
    SwimlaneBorderColor #1E40AF
}

title FLUJO DE ACTIVIDADES: Registro de Notas

|Profesor|
start
:Seleccionar Alumno y Evaluación;
:Ingresar Nota;

|NotaCalculoService|
:Detectar Tipo de Nota;
if (¿Formato Válido?) then (no)
    :Lanzar Error de Formato;
    stop
endif

if (¿Es Alfabética?) then (sí)
    :Validar Nota (AD, A, B, C);
    if (¿Es Válida?) then (sí)
        :Convertir a Escala de Cálculo;
    else (no)
        :Lanzar Error;
        stop
    endif
else (no)
    :Validar Nota (0-20);
    if (¿Rango Válido?) then (sí)
        :Convertir a Escala de Cálculo;
    else (no)
        :Lanzar Error;
        stop
    endif
endif

|RegistroNotaService|
:Verificar Pertenencia a Colegio;
if (¿Mismo Colegio?) then (no)
    :Lanzar Error;
    stop
endif

:Verificar Nota Existente;
if (¿Ya Existe?) then (sí)
    :Lanzar Error;
    stop
endif

note right
  Sistema automáticamente detecta:
  --
  Alfabético (AD, A, B, C)
  Numérico (0-20)
end note

:Guardar Nota con Escala de Cálculo;

note right
  Escala unificada 1.0-4.0
  --
  Alfabético:
  * AD = 4.0
  * A  = 3.0
  * B  = 2.0
  * C  = 1.0
  --
  Numérico:
  * 0-20 -> 1.0-4.0
end note

split
    :Calcular Promedio de Competencia;
split again
    :Calcular Promedio de Curso;
end split

|Profesor|
:Ver Confirmación;
if (¿Registrar Otra Nota?) then (sí)
    :Seleccionar Nuevo Alumno;
    detach
else (no)
    stop
endif

@enduml