@startuml Diagrama de Clases Simplificado - Sistema de Registro de Notas

skinparam class {
    BackgroundColor #E8F4FD
    BorderColor #1F2937
    FontSize 10
}

skinparam package {
    BackgroundColor #F0F9FF
    FontSize 12
}

title DIAGRAMA DE CLASES - N√öCLEO DEL SISTEMA: Registro de Notas

' CONTROLADORES
package "üéØ Controladores" {
    class RegistroNotaController {
        + crearNota()
        + actualizarNota()
        + guardarNotasLote()
        + obtenerNotasPorContexto()
        + calcularPromedios()
    }

    class IaController {
        + estimarNota()
    }
}

' SERVICIOS CORE
package "‚öôÔ∏è Servicios Core" {
    class RegistroNotaService {
        - prisma: PrismaService
        - notaCalculoService: NotaCalculoService
        + crearNota()
        + guardarNotasLote()
        + calcularPromedioCompetencia()
        - verificarPertenenciaColegio()
    }

    class NotaCalculoService {
        + detectarTipoNota()
        + convertirAEscalaCalculo()
        + convertirNumeroALetra()
        - convertirLetraAEscala4()
        - convertirNumeroAEscala4()
    }

    class IaService {
        - prisma: PrismaService
        + estimarNota()
        - calcularRegresion()
        - analizarPatronAprendizaje()
        - calcularMomentumEducativo()
    }
}

' ENTIDADES CORE
package "üìä Entidades Core" {
    class RegistroNota {
        + id: number
        + alumnoId: number
        + evaluacionId: number
        + nota: string
        + notaEscalaCalculo: number
        + registradoPor: number
        + creadoEn: DateTime
    }

    class Evaluacion {
        + id: number
        + nombre: string
        + competenciaId: number
        + profesorAsignacionId: number
        + periodoId: number
    }

    class Alumno {
        + id: number
        + nombres: string
        + apellidos: string
        + dni: string
        + colegioId: number
    }
}

' RELACIONES CON ETIQUETAS
RegistroNotaController --> RegistroNotaService : "usa"
RegistroNotaController ..> NotaCalculoService : "consulta"
IaController --> IaService : "delega"

RegistroNotaService --> NotaCalculoService : "utiliza"
RegistroNotaService --> RegistroNota : "gestiona"
IaService --> RegistroNota : "analiza"

RegistroNota --> Alumno : "pertenece a"
RegistroNota --> Evaluacion : "corresponde a"

' NOTAS EXPLICATIVAS
note right of RegistroNota
    CORAZ√ìN DEL SISTEMA
    
    ‚Ä¢ Input dual: AD,A,B,C o 0-20
    ‚Ä¢ Conversi√≥n autom√°tica a 1.0-4.0
    ‚Ä¢ Constraint √∫nico alumno-evaluaci√≥n
    ‚Ä¢ Auditor√≠a completa
end note

note right of NotaCalculoService
    MOTOR DE CONVERSIONES
    
    ‚Ä¢ Detecci√≥n autom√°tica de tipo
    ‚Ä¢ Escalas unificadas para c√°lculos
    ‚Ä¢ Promedios autom√°ticos
end note

note right of IaService
    SISTEMA IA AVANZADO
    
    ‚Ä¢ 8 algoritmos predictivos
    ‚Ä¢ Confianza variable 30%-100%
    ‚Ä¢ An√°lisis de patrones
end note

@enduml
