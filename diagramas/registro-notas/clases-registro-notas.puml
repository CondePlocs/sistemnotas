@startuml Diagrama de Clases - Sistema de Registro de Notas

skinparam {
    ClassBackgroundColor #FFFFFF
    ClassBorderColor #2E2E2E
    ClassFontSize 11
    ClassAttributeFontSize 10
    ClassStereotypeFontSize 9
    
    ArrowColor #495057
    ArrowThickness 1.5
    
    Shadowing false
    RoundCorner 5
    Linetype ortho
    
    ClassAttributeIconSize 0
    ClassStereotypeFontColor #666666
}

title **DIAGRAMA DE CLASES - CORAZÓN DEL SISTEMA**\n//Sistema de Registro de Notas//

' LAYOUT ORGANIZADO - CONTROLADORES ARRIBA
class RegistroNotaController <<Controller>> {
    {field} -logger
    {field} -registroNotaService
    {field} -notaCalculoService
    --
    {method} +crearNota()
    {method} +actualizarNota()
    {method} +guardarNotasLote()
    {method} +obtenerNotasPorContexto()
    {method} +calcularPromedioCompetencia()
    {method} +calcularPromedioCurso()
}

class IaController <<Controller>> {
    {field} -logger
    {field} -iaService
    --
    {method} +estimarNota()
}

' SERVICIOS EN EL CENTRO
class RegistroNotaService <<Service>> {
    {field} -logger
    {field} -prisma
    {field} -notaCalculoService
    --
    {method} +crearNota()
    {method} +actualizarNota()
    {method} +guardarNotasLote()
    {method} +obtenerNotasPorContexto()
    {method} +calcularPromedioCompetencia()
    {method} +calcularPromedioCurso()
    --
    {method} -verificarPertenenciaColegio()
    {method} -validarNotaExistente()
}

class NotaCalculoService <<Service>> {
    {field} -logger
    --
    {method} +detectarTipoNota()
    {method} +convertirAEscalaCalculo()
    {method} +convertirNumeroALetra()
    {method} +calcularPromedio()
    --
    {method} -convertirLetraAEscala4()
    {method} -convertirNumeroAEscala4()
    {method} -validarNotaAlfabetica()
    {method} -validarNotaNumerica()
}

class IaService <<Service>> {
    {field} -logger
    {field} -prisma
    {field} -config
    --
    {method} +estimarNota()
    --
    {method} -obtenerNotasHistoricas()
    {method} -calcularRegresionLineal()
    {method} -analizarPatronAprendizaje()
    {method} -calcularMomentumEducativo()
    {method} -calcularVolatilidadAcademica()
    {method} -aplicarAlgoritmoPrediccion()
    {method} -calcularConfianza()
}

' ENTIDADES ABAJO
class RegistroNota <<Entity>> {
    {field} +id <<PK>>
    {field} +alumnoId <<FK>>
    {field} +evaluacionId <<FK>>
    {field} +nota
    {field} +notaEscalaCalculo
    {field} +registradoPor
    {field} +creadoEn
    {field} +actualizadoEn
}

class Evaluacion <<Entity>> {
    {field} +id <<PK>>
    {field} +nombre
    {field} +descripcion
    {field} +fechaEvaluacion
    {field} +competenciaId <<FK>>
    {field} +profesorAsignacionId <<FK>>
    {field} +periodoId <<FK>>
    {field} +creadoPor
    {field} +creadoEn
    {field} +actualizadoEn
}

class Alumno <<Entity>> {
    {field} +id <<PK>>
    {field} +nombres
    {field} +apellidos
    {field} +dni <<unique>>
    {field} +fechaNacimiento
    {field} +sexo
    {field} +colegioId <<FK>>
    {field} +activo
    {field} +creadoEn
    {field} +actualizadoEn
}

class Competencia <<Entity>> {
    {field} +id <<PK>>
    {field} +nombre
    {field} +descripcion
    {field} +orden
    {field} +activo
    {field} +cursoId <<FK>>
    {field} +creadoEn
    {field} +actualizadoEn
}

' RELACIONES ORGANIZADAS
RegistroNotaController ..> RegistroNotaService : "usa"
RegistroNotaController ..> NotaCalculoService : "consulta"
IaController ..> IaService : "delega"

RegistroNotaService ..> NotaCalculoService : "utiliza"
RegistroNotaService --> RegistroNota : "gestiona"
IaService --> RegistroNota : "analiza"

RegistroNota }o--|| Alumno : "pertenece a"
RegistroNota }o--|| Evaluacion : "corresponde a"
Evaluacion }o--|| Competencia : "evalúa"

' NOTAS EXPLICATIVAS
note top of RegistroNota : **CORAZÓN DEL SISTEMA**\n• Input dual: AD,A,B,C o 0-20\n• Conversión automática a 1.0-4.0\n• Constraint único alumno-evaluación\n• Auditoría completa

note right of NotaCalculoService : **MOTOR DE CONVERSIONES**\n• Detección automática de tipo\n• Escalas unificadas\n• Cálculos de promedios

note right of IaService : **SISTEMA IA**\n• 8 algoritmos predictivos\n• Confianza 30%-100%\n• Análisis de patrones

@enduml
