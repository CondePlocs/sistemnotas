@startuml Diagrama de Clases - Sistema de Registro de Notas

skinparam {
    ClassBackgroundColor #FFFFFF
    ClassBorderColor #2E2E2E
    ClassFontSize 11
    ClassAttributeFontSize 10
    ClassStereotypeFontSize 9
    
    ArrowColor #495057
    ArrowThickness 1.5
    
    Shadowing false
    RoundCorner 5
    Linetype ortho
    
    ClassAttributeIconSize 0
    ClassStereotypeFontColor #666666
}

title **DIAGRAMA DE CLASES - CORAZÃ“N DEL SISTEMA**\n//Sistema de Registro de Notas//

left to right direction
scale 0.95
skinparam nodesep 30
skinparam ranksep 24

' LAYOUT ORGANIZADO - CONTROLADORES ARRIBA
together {
class RegistroNotaController <<Controller>> {
    {field} -logger
    {field} -registroNotaService
    {field} -notaCalculoService
    --
    {method} +crearNota()
    {method} +actualizarNota()
    {method} +guardarNotasLote()
    {method} +obtenerNotasPorContexto()
    {method} +calcularPromedioCompetencia()
    {method} +calcularPromedioCurso()
}

class IaController <<Controller>> {
    {field} -logger
    {field} -iaService
    --
    {method} +estimarNota()
}

' SERVICIOS EN EL CENTRO
together {
class RegistroNotaService <<Service>> {
    {field} -logger
    {field} -prisma
    {field} -notaCalculoService
    --
    {method} +crearNota()
    {method} +actualizarNota()
    {method} +guardarNotasLote()
    {method} +obtenerNotasPorContexto()
    {method} +calcularPromedioCompetencia()
    {method} +calcularPromedioCurso()
    --
    {method} -verificarPertenenciaColegio()
    {method} -validarNotaExistente()
}

class NotaCalculoService <<Service>> {
    {field} -logger
    --
    {method} +detectarTipoNota()
    {method} +convertirAEscalaCalculo()
    {method} +convertirNumeroALetra()
    {method} +calcularPromedio()
    --
    {method} -convertirLetraAEscala4()
    {method} -convertirNumeroAEscala4()
    {method} -validarNotaAlfabetica()
    {method} -validarNotaNumerica()
}

class IaService <<Service>> {
    {field} -logger
    {field} -prisma
    {field} -config
    --
    {method} +estimarNota()
    --
    {method} -obtenerNotasHistoricas()
    {method} -calcularRegresionLineal()
    {method} -analizarPatronAprendizaje()
    {method} -calcularMomentumEducativo()
    {method} -calcularVolatilidadAcademica()
    {method} -aplicarAlgoritmoPrediccion()
    {method} -calcularConfianza()
}

class ContextoTrabajoService <<Service>> {
    {field} -prisma
    --
    {method} +obtenerAsignaciones()
    {method} +cargarHojaTrabajo()
    {method} +sincronizarCambios()
}

class ReporteNotasService <<Service>> {
    {field} -reporteNotasFactory
    --
    {method} +generarReportePdf()
    {method} +generarReporteExcel()
    {method} +descargarHojaTrabajo()
}

interface INotaRepository <<Repository>> {
    +guardarNota()
    +actualizarNota()
    +buscarPorContexto()
}
}

together {
class HojaTrabajo <<Aggregate>> {
    {field} +contexto
    {field} +alumnos : List<AlumnoEnHoja>
    {field} +evaluaciones : List<EvaluacionActiva>
    --
    {method} +filtrarAlumnos()
    {method} +actualizarNota()
    {method} +obtenerPendientes()
}

class AlumnoEnHoja <<Value Object>> {
    {field} +alumnoId
    {field} +nombreCompleto
    {field} +estadoTarea
    {field} +notas : Map
    --
    {method} +registrarNota()
    {method} +marcarComoActualizado()
}

class EvaluacionActiva <<Value Object>> {
    {field} +evaluacionId
    {field} +competencia
    {field} +tipoNota
    --
    {method} +validarRango()
}
}

together {
abstract class ReporteNotas <<Abstract>> {
    {field} #hojaTrabajo
    --
    {method} +prepararDatos()
    {method} +render()
}

class ReporteNotasExcel <<Reporte>> {
    {method} +render()
}

class ReporteNotasPdf <<Reporte>> {
    {method} +render()
}
}

' RELACIONES ORGANIZADAS
RegistroNotaController --> RegistroNotaService
RegistroNotaController --> NotaCalculoService
RegistroNotaController --> ContextoTrabajoService
IaController --> IaService

RegistroNotaService --> NotaCalculoService
RegistroNotaService o-- HojaTrabajo
RegistroNotaService o-- INotaRepository
ContextoTrabajoService o-- HojaTrabajo
ReporteNotasService ..> HojaTrabajo
ReporteNotasService ..> ReporteNotas
NotaCalculoService ..> HojaTrabajo
IaService ..> HojaTrabajo

HojaTrabajo *-- AlumnoEnHoja
HojaTrabajo o-- EvaluacionActiva
ReporteNotas <|-- ReporteNotasExcel
ReporteNotas <|-- ReporteNotasPdf

'

@enduml
